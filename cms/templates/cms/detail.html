{% extends 'cms/base.html' %}
{% load static %}
{% load tags %}

{% block extra_js %}

  <script src="{% static 'js/babylon.js' %}"></script>
  <script src="{% static 'js/babylonjs.loaders.min.js' %}"></script>

  <script>
      var canvas = document.getElementById("renderCanvas");

      var createScene = function () {
          var scene = new BABYLON.Scene(engine);
      
          //Adding a light
          var light = new BABYLON.PointLight("Omni", new BABYLON.Vector3(20, 20, 100), scene);
      
          //Adding an Arc Rotate Camera
          var camera = new BABYLON.ArcRotateCamera("Camera", 0, 0.8, 100, BABYLON.Vector3.Zero(), scene);
          camera.attachControl(canvas, false);
      
          var assetsManager = new BABYLON.AssetsManager(scene);
          var link = "{% fetch main_file.document.path %}";

          var meshTask = assetsManager.addMeshTask("Model", "", "", link);
        
          meshTask.onSuccess = function (task) {
            task.loadedMeshes[0].position = BABYLON.Vector3.Zero();
          } 
      
          // Move the light with the camera
          scene.registerBeforeRender(function () {
              light.position = camera.position;
          });
        
          assetsManager.onFinish = function (tasks) {
            engine.runRenderLoop(function () {
              scene.render();
            });
          };
        
          assetsManager.load();
      
          return scene;
      }
      
      var engine = new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true });
      var scene = createScene();

      engine.runRenderLoop(function () {
          if (scene) {
              scene.render();
          }
      });

      // Resize
      window.addEventListener("resize", function () {
          engine.resize();
      });
  </script>
{% endblock %}

{% block content %}

  <div class="col-md-9">
    <canvas id="renderCanvas"></canvas>
  </div>

  <div class="col-md-3 detail">
    {% include 'cms/options.html' %}
    <br>
    <table class="table table-bordered table-striped">
      <tbody>
        <tr>
          <td>Name</td>
          <td>{{ entry.name }}</td>
        </tr>
        {% if entry.tags.all %}
        <tr>
          <td>Tags</td>
          <td>
              {{ entry.tags.all|join:", " }}
          </td>
        </tr>
        {% endif %}
        <tr>
          <td>Size</td>
          <td>{{ main_file.document.size|filesizeformat }}</td>
        </tr>
        <tr>
          <td>Date</td>
          <td>{{ entry.date_created|date:"d M Y" }} {{ entry.date_created|time:"H:i" }}</td>
        </tr>
        {% if extra_files %}
        <tr>
          <td>Extra Files</td>
          <td>
            <ul>
              {% for extra in extra_files %}
                <li><a href="{% fetch extra.document.path %}">{% get_file_name extra.document.path %}</a></li>
              {% endfor %}
            </ul>
          </td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>

{% endblock %}
